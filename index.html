<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>◊ò◊ï◊ï◊ó ◊ê◊§◊° | ŸÖÿ≥ÿßŸÅÿ© ÿµŸÅÿ± | Zero Range</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000000;
            color: #333;
            font-family: "TheBasics";
            overflow-x: hidden;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            padding: 20px 0 40px 0;
            border-bottom: 1px solid #ddd;
            margin-bottom: 40px;
            background: rgb(0, 0, 0);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .title {
            font-size: 2.5em;
            font-weight: 300;
            letter-spacing: 3px;
            margin-bottom: 10px;
            padding-top: 20px;
            color: #ffffff;
        }

        .subtitle {
            font-size: 1.2em;
            color: #ffffff;
            font-weight: 300;
            margin-bottom: 50px;
        }

        .public-status {
            font-size: 30px;
            color: #ffffff;
            background: rgba(148, 147, 147, 0.1);
            padding: 10px 20px;
            border-radius: 20px;
            display: inline-block;
        }
        
            /* Mobile responsive styles */
        @media (max-width: 768px) {
            .title { font-size: 1.5em; /* ... */ }
            .subtitle { font-size: 0.9em; /* ... */ }
            .public-status { font-size: 20px; /* ... */ }

            /* Reduce overall padding on mobile */
            body {
                padding: 10px;
            }
            
            .header {
                padding: 15px 10px 30px 10px;
                margin-bottom: 20px;
            }
            
            /* Title adjustments for mobile */
            .title {
                display: flex !important;
                font-size: 1.5em; /* Reduced from 2.5em */
                letter-spacing: 1px; /* Reduced from 3px */
                padding-bottom: 12px;
                gap: 10px !important; /* Reduced from 18px */
                justify-content: center !important; /* Center the content */
                align-items: center !important;
                direction: ltr !important; /* Force LTR for consistent ordering */

            }
            
            .title span {
                min-width: auto !important; /* Remove fixed width */
                font-size: 22px !important; /* Reduced from 35px for English */
                text-align: center !important;
                flex: 1 !important; /* Equal width distribution */
            }
            
            /* Arrange: English (left), Arabic (center), Hebrew (right) */
            .title span:nth-child(1) { order: 1 !important; } /* English - left */
            .title span:nth-child(2) { order: 2 !important; } /* Arabic - center */
            .title span:nth-child(3) { order: 3 !important; } /* Hebrew - right */

            
            /* Subtitle adjustments for mobile */
            .subtitle {
                display: flex !important;
                font-size: 0.9em; /* Reduced from 1.2em */
                margin-bottom: 30px; /* Reduced from 50px */
                gap: 10px !important; /* Reduced from 18px */
                justify-content: center !important; /* Center the content */
                align-items: center !important;
                direction: ltr !important; /* Force LTR for consistent ordering */

            }
            
            .subtitle span {
                min-width: auto !important; /* Remove fixed width */
                font-size: 14px;
                text-align: center !important;
                flex: 1 !important; /* Equal width distribution */
            }
            
            /* Same order for subtitle: English (left), Arabic (center), Hebrew (right) */
            .subtitle span:nth-child(1) { order: 1 !important; } /* English - left */
            .subtitle span:nth-child(2) { order: 2 !important; } /* Arabic - center */
            .subtitle span:nth-child(3) { order: 3 !important; } /* Hebrew - right */
            
            /* Status counter adjustments */
            .public-status {
                font-size: 20px; /* Reduced from 30px */
                padding: 8px 16px;
            }
            
            /* Adjust memory cards for mobile */
            .memory-card {
                width: 100%; /* Full width on mobile */
                max-width: 350px; /* But not too wide */
                height: auto; /* Auto height */
                min-height: 500px;
            }
            
            .grid {
                gap: 20px; /* Reduced gap */
                padding: 10px 0;
            }
        }

        /* Even smaller screens (phones in portrait) */
        @media (max-width: 480px) {
            .title {
                font-size: 1.2em;
                flex-direction: row !important; /* Keep horizontal layout */
                justify-content: center !important; /* Center the content */
                align-items: center !important;
                gap: 10px !important; /* Smaller gap for mobile */
                direction: ltr !important; /* Force LTR for consistent ordering */

            }
            
            .title span {
                font-size: 16px !important; /* Smaller font for mobile */
                text-align: center !important;
                min-width: auto !important; /* Remove fixed width */
                flex: 1 !important; /* Equal width distribution */
            }
            
            /* Arrange: English (left), Arabic (center), Hebrew (right) */
            .title span:nth-child(1) { order: 1 !important; } /* English - left */
            .title span:nth-child(2) { order: 2 !important; } /* Arabic - center */
            .title span:nth-child(3) { order: 3 !important; } /* Hebrew - right */
            
            .subtitle {
                font-size: 0.8em;
                flex-direction: row !important; /* Keep horizontal layout */
                justify-content: center !important; /* Center the content */
                align-items: center !important;
                gap: 8px !important; /* Smaller gap for mobile */
                direction: ltr !important; /* Force LTR for consistent ordering */

            }
            
            .subtitle span {
                font-size: 11px !important; /* Smaller font for mobile */
                text-align: center !important;
                min-width: auto !important; /* Remove fixed width */
                flex: 1 !important; /* Equal width distribution */
            }
            
            /* Same order for subtitle: English (left), Arabic (center), Hebrew (right) */
            .subtitle span:nth-child(1) { order: 1 !important; } /* English - left */
            .subtitle span:nth-child(2) { order: 2 !important; } /* Arabic - center */
            .subtitle span:nth-child(3) { order: 3 !important; } /* Hebrew - right */

            .public-status {
                font-size: 18px;
                padding: 6px 12px;
            }
        }

        /* Landscape orientation on mobile */
        @media (max-width: 768px) and (orientation: landscape) {
            .header {
                padding: 10px 10px 20px 10px;
            }
            
            .title {
                font-size: 1.3em;
                margin-bottom: 5px;
            }
            
            .subtitle {
                font-size: 0.85em;
                margin-bottom: 20px;
            }
        }

        /* ADMIN PANEL - Hidden by default */
        .admin-panel {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .admin-panel.visible {
            display: block;
        }
        
        .admin-title {
            color: #e74c3c;
            font-size: 18px;
            margin-bottom: 15px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .admin-notice {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid #e74c3c;
            color: #e74c3c;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
            font-size: 12px;
        }
        
        .config-group {
            margin-bottom: 15px;
        }
        
        .config-label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
            color: #666;
        }
        
        .config-input {
            width: 100%;
            padding: 8px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            color: #333;
            font-size: 11px;
            font-family: monospace;
            /* Make read-only fields appear different */
        }
        
        .config-input:disabled {
            background: #e9ecef;
            color: #6c757d;
            cursor: not-allowed;
        }
        
        .config-input:focus {
            border-color: #3498db;
            outline: none;
        }
        
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
          
        .btn-danger {
            background: #e74c3c;
            color: #fff;
        }
        
        .stats {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            border: 1px solid #ddd;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .stats.visible {
            display: block;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            min-width: 180px;
        }
        
        .stat-value {
            color: #ffffff;
            font-weight: bold;
        }
        
        .grid-container {
            max-width: flex;
            margin: 0 auto;

        }
        
        .grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 40px;
            padding: 20px 0;
        }
        
        /* Memory Card Styles */
        .memory-card {
            width: 400px;
            height: 550px;
            background: #000000;
            border: 3px solid #3e3e3e;
            padding: 20px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0);
            transition: all 1s ease;
            position: relative;
        }

        .memory-card:hover {
            /*transform: translateY(-2px);*/
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .memory-card.has-image {
            box-shadow: 0 0 20px rgba(169, 169, 169, 0);
        }
        
        .date-time {
            font-size: 16px;
            color: #ffffff86;
            margin-top: 5px;
            margin-bottom: 10px;
            text-align: center;
            font-weight: bold;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.495);

        }

        .visitor-number {
            font-size: 20px;
            color: #ffffff;
            margin-bottom: 15px;
            background: #000000;
            padding: 8px;
            border-radius: 4px;
            text-align: center;
            line-height: 1.3;
        }

        .visitor-words {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 4px;
            padding-bottom: 5px;
            padding-top: 5px;

        }

        .visitor-hebrew, .visitor-arabic, .visitor-english {
            font-size: 20px;
        }

        .visitor-num {
            font-size: 20px;
            font-weight: bold;
            color: #ffffff;
        }

        .image-placeholder {
            width: 100%;
            aspect-ratio: 16 / 9;
            background: #000000;
            border: 2px dashed #88888890;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ffffff;
            font-size: 12px;
            margin: 8px 0 20px 0;
            transition: all 0.3s ease;
            margin-top: 135px;
            margin-bottom: 30px;
        }


        .card-image {
            width: 100%;
            aspect-ratio: 16 / 9;
            object-fit: cover;
            border-radius: 4px;
            margin: 8px 0 20px 0;
            opacity: 0;
            padding-bottom: 15px;
            transition: opacity 0.5s ease;
        }
        
        .card-image.loaded {
            opacity: 1;
        }
        
        .for-text {
            font-size: 15px;
            color: #ffffffb4;
            margin-bottom: 15px;
            text-align: center;
            padding-bottom: 15px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.495);
        }
        
        .name-arabic {
            font-size: 16px;
            color: #ffffff;
            direction: rtl;
            margin-bottom: 15px;
            font-weight: bold;
            font-family: 'TheBasics','Noto Sans Arabic', 'Arial Unicode MS', 'Tahoma', sans-serif;
        }
        
        .name-hebrew {
            font-size: 16px;
            color: #ffffff;
            direction: rtl;
            margin-bottom: 15px;
            font-weight: bold;
            font-family: 'TheBasics','Noto Sans Hebrew', 'Arial Unicode MS', 'David', sans-serif;
        }
        
        .name-english {
            font-size: 15px;
            color: #ffffff;
            margin-bottom: 30px;
            font-weight: bold;
            font-family: 'TheBasics','Noto Sans', sans-serif;
        }
        
        .card-index {
            position: absolute;
            top: 5px;
            left: 8px;
            font-size: 30px;
            color: #999;
            font-weight: normal;
        }
        
        .loading-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(52, 152, 219, 0.1);
            border: 1px solid #3498db;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 12px;
            display: none;
            color: #3498db;
        }
        
        .loading-indicator.active {
            display: block;
        }
        
        .message {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 12px;
        }
        
        .message.error {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid #e74c3c;
            color: #e74c3c;
        }
        
        .message.success {
            background: rgba(46, 204, 113, 0.1);
            border: 1px solid #2ecc71;
            color: #2ecc71;
        }
        
        .message.info {
            background: rgba(243, 156, 18, 0.1);
            border: 1px solid #f39c12;
            color: #f39c12;
        }
        
        .server-status {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .server-status.online {
            background: rgba(46, 204, 113, 0.1);
            border: 1px solid #2ecc71;
            color: #2ecc71;
        }
        
        .server-status.offline {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid #e74c3c;
            color: #e74c3c;
        }

        /* Admin mode indicator */
        .admin-indicator {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(231, 76, 60, 0.9);
            color: #fff;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
            z-index: 1001;
            display: none;
        }
        
        .admin-indicator.visible {
            display: block;
        }

        .image-modal {
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0);
            display: flex;
            justify-content: center;
            align-items: center;
            visibility: hidden;
            opacity: 0;
            transition: all 0.6s ease 0.2s;
            padding: 40px;

        }


        .image-modal.visible {
            visibility: visible;
            opacity: 1;
            background: rgba(0, 0, 0, 0.8);
        }

        /* Container for image and info */
        .modal-content {
            display: flex;
            align-items: center;
            gap: 30px;
            max-width: 90%;
            max-height: 90%;
        }

        /* When info is hidden, center the image */
        .modal-content.info-hidden {
            justify-content: center;
        }

        /* Adjust image size based on whether info is shown */
        .modal-content.info-hidden img {
            max-width: 95%;
            max-height: 95vh;
        }

        /* Default image size when info is shown */
        .modal-content.info-shown img {
            max-width: 70%;
            max-height: 90vh;
        }

        .image-modal img {
            max-width: 90%;
            max-height: 95vh;
            border-radius: 6px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            transform: scale(0.8);
            opacity: 0;
            transition: all 0.6s ease 0.2s;
            object-fit: contain;
        }

        .image-modal.visible img {
            transform: scale(1.2);
            opacity: 1;
        }

        .modal-info {
            color: rgb(255, 255, 255);
            background: rgb(0, 0, 0);
            backdrop-filter: blur(10px);
            padding: 20px 25px;
            border-radius: 2px;
            font-size: 16px;
            line-height: 1.6;
            min-width: 400px;
            opacity: 0;
            transform: translateX(30px);
            transition: all 0.1s ease-out 0.2s;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .image-modal.visible .modal-info {
            opacity: 1;
            transform: translateX(0);
        }

        .modal-info strong {
            font-size: 20px;
            display: block;
            margin-bottom: 10px;
            color: rgb(255, 255, 255);
        }

        .modal-info small {
            display: block;
            margin-top: 15px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 30px;
            color: rgb(124, 124, 124);
            font-size: 100px;
            cursor: pointer;
            font-weight: bold;
            user-select: none;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.3s ease 0.1s;
            z-index: 10;
        }

        .image-modal.visible .close-btn {
            opacity: 1;
            transform: scale(1);
        }

        .close-btn:hover {
            transform: scale(1.1);
        }

        @font-face {
            font-family: 'TheBasics';
            src: url('https://raw.githubusercontent.com/eland85/ZeroRange-frontend/main/fonts/TheBasics-Medium.otf') format('opentype');
            font-weight: 300;
            font-style: normal;
            font-display: auto; /* Improves loading performance */
        }

        @font-face {
            font-family: 'TheBasics';
            src: url('https://raw.githubusercontent.com/eland85/ZeroRange-frontend/main/fonts/TheBasics-Black.otf') format('opentype');
            font-weight: 400;
            font-style: normal;
            font-display: swap; /* Improves loading performance */
        }

        @font-face {
            font-family: 'TheBasics';
            src: url('https://raw.githubusercontent.com/eland85/ZeroRange-frontend/main/fonts/TheBasics-Black.otf') format('opentype');
            font-weight: 700;
            font-style: normal;
            font-display: auto;
        }

                /* Responsive adjustments */
        @media (max-width: 768px) {
            .modal-content {
                flex-direction: column;
                gap: 20px;
            }
            
            .image-modal img {
                max-width: 90%;
                max-height: 60vh;
            }
            
            .modal-info {
                transform: translateY(30px);
                width: 90%;
                max-width: 400px;
            }
            
            .image-modal.visible .modal-info {
                transform: translateY(0);
            }
        }

    </style>
</head>
<body>
    <!-- Admin Mode Indicator -->
    <div class="admin-indicator" id="admin-indicator">
        üîß ADMIN MODE - Press Ctrl+A to hide
    </div>

    <div class="header">
        <div class="title" style="padding-bottom: 18px; display: flex; justify-content: center; align-items: flex-end; gap: 50px;">
            <span style="order: 3; text-align: left; min-width: 120px; font-size: 35px;">Zero Range</span>
            <span style="order: 2; text-align: center; min-width: 120px; display: flex; flex-direction: column; align-items: center;">
            <span>ŸÖÿ≥ÿßŸÅÿ© ÿµŸÅÿ±</span>
            </span>
            <span style="order: 1; text-align: right; min-width: 120px;">◊ò◊ï◊ï◊ó ◊ê◊§◊°</span>
        </div>
        <div class="subtitle" style="display: flex; justify-content: center; align-items: flex-start; gap: 50px;">
            <span style="order: 3; text-align: left; min-width: 120px;">An Embodied Archive</span>
            <span style="order: 2; text-align: center; min-width: 120px; display: flex; flex-direction: column; align-items: center;">
            <span>ÿ£ÿ±ÿ¥ŸäŸÅ ŸÖÿ¨ÿ≥ÿØ</span>
            </span>
            <span style="order: 1; text-align: right; min-width: 120px;">◊ê◊®◊õ◊ô◊ï◊ü ◊û◊í◊ï◊ú◊ù</span>
        </div>
        <div class="public-status" id="public-status" style="text-align: center;">
            ...Loading
        </div>
        </div>
    <!-- ADMIN PANEL - Hidden by default -->
    <div class="admin-panel" id="admin-panel">
        <div class="admin-title">üîß Administrator Controls</div>
        <div class="admin-notice">
            <strong>ADMIN MODE:</strong> Press Ctrl+A to hide this panel from public view
        </div>
        
        <div id="server-status" class="server-status offline">
            <strong>üîå Connecting to secure backend...</strong>
        </div>
        
        <div class="config-group">
            <label class="config-label">Configuration Status:</label>
            <div id="config-status" class="config-input" style="background: #f8f9fa; padding: 12px; border-radius: 4px;">
                Loading server configuration...
            </div>
        </div>
        <div style="text-align: center;">
            <button class="btn" onclick="checkServerConnection()">üîç Check Connection</button>
            <button class="btn" onclick="discoverImages()">üì∏ Discover Images</button>
            <button class="btn" onclick="startExhibition()">üöÄ Start Exhibition</button>
        </div>
        
        <div id="messages"></div>
    </div>
    
    <!-- ADMIN STATS - Hidden by default -->
    <div class="stats" id="stats">
        <div class="stat-item">
            <span>Server Status:</span>
            <span class="stat-value" id="server-indicator">‚ùå Offline</span>
        </div>
        <div class="stat-item">
            <span>Google Sheets:</span>
            <span class="stat-value" id="sheets-status">‚ùå Not loaded</span>
        </div>
        <div class="stat-item">
            <span>Images Found:</span>
            <span class="stat-value" id="discovered-count">0</span>
        </div>
        <div class="stat-item">
            <span>Memory Cards:</span>
            <span class="stat-value" id="total-count">0</span>
        </div>
        <div class="stat-item">
            <span>Images Loaded:</span>
            <span class="stat-value" id="loaded-count">0</span>
        </div>
        <div class="stat-item">
            <span>Last Update:</span>
            <span class="stat-value" id="last-update">Never</span>
        </div>
    </div>
    
    <div class="loading-indicator" id="loading-indicator">
        üîÑ Updating memory cards...
    </div>
    
    <div class="grid-container">
        <div class="grid" id="main-grid">
            <!-- Memory cards will be populated by JavaScript -->
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            backendUrl: 'https://web-production-45622.up.railway.app',
            refreshInterval: 30000,
            showModalInfo: false,
            autoScrollToLatest: true, // ‚Üê ADD THIS
            scrollDelay: 3000, // ‚Üê ADD THIS (delay in milliseconds)
            scrollDuration: 6000 // ‚Üê ADD THIS: constant scroll duration in milliseconds

      };

        // Global state
        let participantData = [];
        let discoveredImages = {};
        let loadedImages = new Set();
        let refreshTimer = null;
        let serverOnline = false;
        let adminMode = false;
        let serverConfig = {}; // Store server configuration
        
        // Load server configuration
        async function loadServerConfig() {
            try {
                const response = await fetch(`${CONFIG.backendUrl}/api/config`);
                const data = await response.json();
                
                serverConfig = data;
                
                // Update the admin panel with status only (no IDs shown)
                const configStatus = document.getElementById('config-status');
                let statusHTML = '';
                
                if (data.api_configured) {
                    statusHTML += '‚úÖ <strong>Google API:</strong> Configured<br>';
                } else {
                    statusHTML += '‚ùå <strong>Google API:</strong> Not configured<br>';
                }
                
                if (data.folder_configured) {
                    statusHTML += '‚úÖ <strong>Drive Folder:</strong> Configured<br>';
                } else {
                    statusHTML += '‚ùå <strong>Drive Folder:</strong> Not configured<br>';
                }
                
                if (data.sheets_configured) {
                    statusHTML += '‚úÖ <strong>Google Sheets:</strong> Configured';
                } else {
                    statusHTML += '‚ùå <strong>Google Sheets:</strong> Not configured';
                }
                
                configStatus.innerHTML = statusHTML;
                
                // Log to console for debugging (IDs still hidden)
                console.log('‚úÖ Server configuration loaded');
                console.log(`   API configured: ${data.api_configured}`);
                console.log(`   Folder configured: ${data.folder_configured}`);
                console.log(`   Sheets configured: ${data.sheets_configured}`);
                
                return true;
            } catch (error) {
                console.error('‚ùå Failed to load server configuration:', error);
                document.getElementById('config-status').innerHTML = 
                    '‚ùå <span style="color: #e74c3c;">Error loading server configuration</span>';
                return false;
            }
        }
        
        // ...existing code...
        function scrollToMostRecentImage() {
            if (!CONFIG.autoScrollToLatest) return;
            
            setTimeout(() => {
                let mostRecentCard = null;
                let mostRecentTime = null;
                
                // Find the card with the most recent image upload
                for (const participant of participantData) {
                    const index = participant.index;
                    
                    if (loadedImages.has(index) && discoveredImages[index]) {
                        const imageData = discoveredImages[index];
                        const modifiedTime = new Date(imageData.modified);
                        
                        if (!mostRecentTime || modifiedTime > mostRecentTime) {
                            mostRecentTime = modifiedTime;
                            mostRecentCard = document.getElementById(`card-${index}`);
                        }
                    }
                }
                
                if (mostRecentCard) {
                    console.log(`üìç Auto-scrolling to most recent image: ${mostRecentTime.toLocaleString()}`);
                    
                    // Custom scroll animation with CONSTANT DURATION regardless of distance
                    const targetPosition = mostRecentCard.offsetTop - (window.innerHeight / 4);
                    const startPosition = window.pageYOffset;
                    const distance = targetPosition - startPosition;
                    const constantDuration = CONFIG.scrollDuration; // Use configurable duration

                    console.log(`üéØ Scrolling ${Math.abs(distance)}px in ${constantDuration/1000} seconds`);

                    let start = null;
                    
                    function animateScroll(timestamp) {
                        if (!start) start = timestamp;
                        const progress = timestamp - start;
                        const percentage = Math.min(progress / constantDuration, 1);
                        
                        // Ease-in-out function for slow start and slow end
                        const ease = 0.5 * (1 - Math.cos(Math.PI * percentage));
                        
                        window.scrollTo(0, startPosition + (distance * ease));
                        
                        if (progress < constantDuration) {
                            requestAnimationFrame(animateScroll);
                        } else {
                            // Add highlight effect after scroll completes
                            mostRecentCard.style.transition = 'box-shadow 2s ease';
                            mostRecentCard.style.boxShadow = '0 0 20px rgba(255, 255, 255, 0.2)';
                            
                            setTimeout(() => {
                                mostRecentCard.style.boxShadow = '';
                            }, 3000);
                        }
                    }
                    
                    requestAnimationFrame(animateScroll);
                }
            }, CONFIG.scrollDelay);
        }

        // Admin mode toggle
        function toggleAdminMode() {
            adminMode = !adminMode;
            
            const adminPanel = document.getElementById('admin-panel');
            const stats = document.getElementById('stats');
            const adminIndicator = document.getElementById('admin-indicator');
            
            if (adminMode) {
                adminPanel.classList.add('visible');
                stats.classList.add('visible');
                adminIndicator.classList.add('visible');
                console.log('üîß Admin mode enabled');
            } else {
                adminPanel.classList.remove('visible');
                stats.classList.remove('visible');
                adminIndicator.classList.remove('visible');
                console.log('üëÅÔ∏è Public mode enabled');
            }
        }
        
        // Keyboard shortcut for admin mode
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey && event.key === 'a') {
                event.preventDefault();
                toggleAdminMode();
            }
        });
        
        // Update public status display
        function updatePublicStatus() {
            const totalCards = participantData.length;
            const recognizedCount = loadedImages.size;
            
            if (totalCards > 0) {
                document.getElementById('public-status').textContent = 
                    `${totalCards} / ${recognizedCount}`;
            } else {
                document.getElementById('public-status').textContent = 
                    'Loading memory cards...';
            }
        }
        
        async function checkServerConnection() {
            try {
                showLoading();
                const response = await fetch(`${CONFIG.backendUrl}/api/status`);
                
                if (response.ok) {
                    const data = await response.json();
                    serverOnline = true;
                    
                    document.getElementById('server-indicator').textContent = '‚úÖ Online';
                    document.getElementById('server-status').className = 'server-status online';
                    document.getElementById('server-status').innerHTML = 
                        `<strong>üîí Secure backend connected!</strong><br>
                         Authentication: API Key<br>
                         API: ${data.api_configured ? '‚úÖ' : '‚ùå'} | 
                         Folder: ${data.folder_configured ? '‚úÖ' : '‚ùå'} | 
                         Sheets: ${data.sheets_configured ? '‚úÖ' : '‚ùå'}<br>
                         Server time: ${new Date(data.timestamp).toLocaleTimeString()}`;
                    
                    if (adminMode) showMessage('‚úÖ Connected to secure backend!', 'success');
                } else {
                    throw new Error(`Server returned ${response.status}`);
                }
            } catch (error) {
                serverOnline = false;
                document.getElementById('server-indicator').textContent = '‚ùå Offline';
                document.getElementById('server-status').className = 'server-status offline';
                document.getElementById('server-status').innerHTML = 
                    `<strong>‚ùå Cannot connect to secure backend</strong><br>
                     Error: ${error.message}`;
                
                if (adminMode) showMessage('‚ùå Backend connection failed.', 'error');
            } finally {
                hideLoading();
            }
        }
        
        async function discoverImages() {
            if (!serverOnline) {
                if (adminMode) showMessage('‚ùå Backend not connected. Check connection first.', 'error');
                return;
            }
            
            try {
                if (adminMode) showLoading();
                if (adminMode) showMessage('üîç Securely discovering images using server configuration...', 'info');
                
                // Use the new endpoint that doesn't require folder ID parameter
                const response = await fetch(`${CONFIG.backendUrl}/api/discover`);
                const data = await response.json();
                
                if (data.success) {
                    discoveredImages = data.images;
                    document.getElementById('discovered-count').textContent = data.total_found;
                    
                    console.log('üéØ Discovered images:', discoveredImages);
                    if (adminMode) showMessage(`üéâ Found ${data.total_found} images using server folder ID!`, 'success');
                } else {
                    throw new Error(data.error || 'Discovery failed');
                }
            } catch (error) {
                if (adminMode) showMessage(`‚ùå Discovery failed: ${error.message}`, 'error');
                console.error('Discovery error:', error);
            } finally {
                if (adminMode) hideLoading();
            }
        }
        
        async function loadGoogleSheets() {
            try {
                // Use the new endpoint that doesn't require sheets ID parameter
                const response = await fetch(`${CONFIG.backendUrl}/api/sheets`);
                const data = await response.json();
                
                if (data.success) {
                    participantData = parseCSV(data.csv_data);
                    document.getElementById('sheets-status').textContent = '‚úÖ Loaded';
                    document.getElementById('total-count').textContent = participantData.length;
                    
                    updatePublicStatus();
                    if (adminMode) showMessage(`‚úÖ Loaded ${participantData.length} memory cards using server sheets ID`, 'success');
                    return true;
                } else {
                    throw new Error(data.error || 'Failed to load sheets');
                }
            } catch (error) {
                document.getElementById('sheets-status').textContent = '‚ùå Error';
                if (adminMode) showMessage(`‚ùå Sheets error: ${error.message}`, 'error');
                return false;
            }
        }
        
        async function startExhibition() {
            if (!serverOnline) {
                if (adminMode) showMessage('‚ùå Backend not connected', 'error');
                return;
            }
            
            const sheetsLoaded = await loadGoogleSheets();
            if (!sheetsLoaded) return;
            
            await discoverImages();
            createMemoryCards();
            startAutoRefresh();
            
            // üÜï ADD THIS LINE:
            scrollToMostRecentImage();
            
            if (adminMode) showMessage('üöÄ Exhibition started with server configuration! Auto-updating.', 'success');
        }
        
        function parseCSV(csvText) {
            // Fix Unicode encoding if needed
            try {
                if (csvText.includes('\\u')) {
                    csvText = csvText.replace(/\\u[\dA-F]{4}/gi, function (match) {
                        return String.fromCharCode(parseInt(match.replace(/\\u/g, ''), 16));
                    });
                    console.log('üî§ Fixed Unicode encoding in CSV');
                }
            } catch (error) {
                console.warn('Unicode fix failed:', error);
            }
            
            const lines = csvText.trim().split(/\r?\n/);
            const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
            
            const data = [];
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim());
                const item = {
                    nameArabic: values[headers.indexOf('namearabic')] || `ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉ ${i}`,
                    nameEnglish: values[headers.indexOf('nameenglish')] || `Participant ${i}`,
                    nameHebrew: values[headers.indexOf('namehebrew')] || `◊û◊©◊™◊™◊£ ${i}`,
                    dateOfBirth: values[headers.indexOf('dateofbirth')] || '',
                    age: values[headers.indexOf('age')] || '',
                    visitor: values[headers.indexOf('visitor')] || `${i}`,
                    time: values[headers.indexOf('time')] || '00:00',
                    date: values[headers.indexOf('date')] || '10.7.2025',
                    index: i
                };
                data.push(item);
            }
            
            return data;
        }
        
        function createMemoryCards() {
            const grid = document.getElementById('main-grid');
            grid.innerHTML = '';
            
            participantData.forEach((participant, i) => {
                const card = document.createElement('div');
                card.className = `memory-card layout${(i % 10) + 1}`;
                card.id = `card-${participant.index}`;
                
                const hasImage = discoveredImages[participant.index];
                const placeholderText = hasImage ? '' : '';

                card.innerHTML = `
                    <div class="date-time" style="display:none;">${participant.time}|${participant.date}</div>
                    <div class="visitor-number" style="display:none;">
                        <div class="visitor-words">
                            <span style="font-size: 16px;">◊û◊ë◊ß◊®/◊™</span>
                            <span style="font-size: 16px; margin: 0 8px;">ÿ≤ÿßÿ¶ÿ±/ÿ©</span>
                            <span style="font-size: 15px;">Visitor</span>
                        </div>
                        <div class="visitor-num">#${participant.visitor}</div>
                    </div>
                    <div class="image-placeholder">${placeholderText}</div>
                    <div class="for-text">
                        <span style="display: inline-block; margin-right: 9px;">◊¢◊ë◊ï◊®</span>
                        <span style="display: inline-block; margin: 0 9px;">ÿ•ŸÑŸâ</span>
                        <span style="display: inline-block; margin-left: 9px;">For</span>
                    </div>
                    <div class="name-arabic" style="text-align:center;">${participant.nameArabic}</div>
                    <div class="name-hebrew" style="text-align:center;">${participant.nameHebrew}</div>
                    <div class="name-english" style="text-align:center;">${participant.nameEnglish}</div>
                `;

                
                grid.appendChild(card);
            });
            
            // Load discovered images
            loadDiscoveredImages();
            console.log(`üèóÔ∏è Created memory card exhibition with ${participantData.length} cards`);
        }
        
        function loadDiscoveredImages() {
            for (const participant of participantData) {
                const index = participant.index;
                
                if (!loadedImages.has(index) && discoveredImages[index]) {
                    const imageData = discoveredImages[index];
                    const proxyUrl = `${CONFIG.backendUrl}/api/proxy-image/${imageData.id}`;
                    loadImageIntoCard(index, proxyUrl);
                    loadedImages.add(index);
                    console.log(`‚úÖ Image loaded: ${imageData.name} ‚Üí Card ${index}`);
                }
            }
            
            updateStats();
            updatePublicStatus();
        }
        
        function loadImageIntoCard(index, imagePath) {
            const card = document.getElementById(`card-${index}`);
            if (!card) return;

            const placeholder = card.querySelector('.image-placeholder');
            if (!placeholder) return;

            const img = document.createElement('img');
            img.className = 'card-image';
            img.src = imagePath;
            img.alt = `Memory card ${index} image`;

            img.onload = () => {
                img.classList.add('loaded');
                placeholder.style.display = 'none';
                placeholder.parentNode.insertBefore(img, placeholder);
                card.classList.add('has-image');

                // ‚úÖ Update date/time dynamically
                if (discoveredImages[index] && discoveredImages[index].modified) {
                    const modifiedDate = new Date(discoveredImages[index].modified);
                    const formattedDate = modifiedDate.toLocaleDateString('he-IL');
                    const formattedTime = modifiedDate.toLocaleTimeString('he-IL', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    // Set date/time with flex layout for justification
                    const dateTimeDiv = card.querySelector('.date-time');
                    dateTimeDiv.innerHTML = `
                        <span style="float: right; text-align: right; width: 48%;">${formattedTime}</span>
                        <span style="float: left; text-align: left; width: 48%;">${formattedDate}</span>
                        <span style="clear: both; display: block;"></span>
                    `;
                }

                card.querySelector('.date-time').style.display = 'block';
                card.querySelector('.visitor-number').style.display = 'block';

                // ‚úÖ CLICK TO OPEN MODAL
                img.addEventListener('click', () => {
                    openImageModal(img.src, card);
                });

                updatePublicStatus();
            };


            img.onerror = () => {
                console.warn(`‚ùå Failed to load image for card ${index}`);
                placeholder.textContent = 'Image unavailable';
                placeholder.style.color = '#e74c3c';
            };
        }

        
        function startAutoRefresh() {
            if (refreshTimer) clearInterval(refreshTimer);
            
            refreshTimer = setInterval(async () => {
                if (serverOnline) {
                    try {
                        // Use the server configuration endpoint instead of manual folder ID
                        const response = await fetch(`${CONFIG.backendUrl}/api/discover`);
                        const data = await response.json();
                        
                        if (data.success) {
                            const newImageCount = Object.keys(data.images).length;
                            const oldImageCount = Object.keys(discoveredImages).length;
                            
                            if (newImageCount > oldImageCount) {
                                discoveredImages = data.images;
                                document.getElementById('discovered-count').textContent = newImageCount;
                                loadDiscoveredImages();
                                console.log(`üîÑ Auto-discovered ${newImageCount - oldImageCount} new images`);
                            }
                        }
                    } catch (error) {
                        console.warn('Auto-refresh error:', error);
                    }
                }
                
                updateStats();
            }, CONFIG.refreshInterval);
            
            console.log('üîÑ Auto-refresh started (30s intervals)');
        }
        
        function updateStats() {
            document.getElementById('loaded-count').textContent = loadedImages.size;
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
        }
        
        function showMessage(text, type = 'info') {
            if (!adminMode) return; // Only show messages in admin mode
            
            const messages = document.getElementById('messages');
            const div = document.createElement('div');
            div.className = `message ${type}`;
            div.textContent = text;
            messages.appendChild(div);
            
            setTimeout(() => {
                if (div.parentNode) div.remove();
            }, 8000);
        }
        
        function showLoading() {
            document.getElementById('loading-indicator').classList.add('active');
        }
        
        function hideLoading() {
            document.getElementById('loading-indicator').classList.remove('active');
        }
        
        // Initialize

        // ‚úÖ Declare globally at top of script
        let modal, modalImg, modalInfo, closeBtn;

        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üåê Memory Cards Exhibition initialized');
            updateStats();
            
            // ‚úÖ Initialize modal after DOM is ready
            modal = document.getElementById('image-modal');
            modalImg = document.querySelector('#image-modal .modal-image');
            modalInfo = document.getElementById('modal-info');
            closeBtn = document.querySelector('.close-btn');

            closeBtn.onclick = () => modal.classList.remove('visible');
            modal.onclick = (e) => {
                if (e.target === modal) modal.classList.remove('visible');
            };

            // Load server configuration first
            console.log('üîß Loading server configuration...');
            await loadServerConfig();

            // Auto-start the exhibition
            setTimeout(async () => {
                await checkServerConnection();
                if (serverOnline) {
                    await startExhibition();
                } else {
                    console.log('‚ùå Server offline - no demo data available');
                }
            }, 1000);
        });



        function openImageModal(src, card) {
            modalImg.src = src;
            
            // Only populate info if showModalInfo is true
            if (CONFIG.showModalInfo && modalInfo) {
                const dateTime = card.querySelector('.date-time').textContent;
                const visitor = card.querySelector('.visitor-num').textContent;
                const nameArabic = card.querySelector('.name-arabic').textContent;
                const nameHebrew = card.querySelector('.name-hebrew').textContent;
                const nameEnglish = card.querySelector('.name-english').textContent;

                modalInfo.innerHTML = `
                    <div class="modal-visitor-line">
                        <span style="font-size: 14px;color: rgba(255,255,255,0.7);">◊û◊ë◊ß◊®.◊™</span>
                        <span style="font-size: 14px; color: rgba(255,255,255,0.7);margin: 0 8px;">ÿ≤ÿßÿ¶ÿ±/ÿ©</span>
                        <span style="font-size: 13px;color: rgba(255,255,255,0.7);">Visitor</span>
                    </div>
                    <div style="font-size: 16px; font-weight: bold; margin-bottom: 15px; color: rgba(255,255,255,0.7);">${visitor}</div>
                    <strong>${nameArabic}</strong>
                    <div style="font-size: 18px; font-weight: bold; margin-bottom: 5px;">${nameHebrew}</div>
                    <div style="font-size: 16px; font-weight: bold; color: rgba(255,255,255,0.9); text-align: right; direction: ltr;">${nameEnglish}</div>
                    <small>${dateTime}</small>
                `;
                
                modalInfo.style.display = 'block';
                modal.querySelector('.modal-content').classList.remove('info-hidden');
                modal.querySelector('.modal-content').classList.add('info-shown');
            } else if (modalInfo) {
                modalInfo.style.display = 'none';
                modal.querySelector('.modal-content').classList.remove('info-shown');
                modal.querySelector('.modal-content').classList.add('info-hidden');
            }
            
            // Force a reflow to ensure the transition works
            modal.offsetHeight;
            modal.classList.add('visible');
        }

        // Update the close handlers
        closeBtn.onclick = () => {
            modal.classList.remove('visible');
        };

        modal.onclick = (e) => {
            if (e.target === modal) {
                modal.classList.remove('visible');
            }
        };

        // Optional: Add keyboard support
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.classList.contains('visible')) {
                modal.classList.remove('visible');
            }
        });

    </script>
<div id="image-modal" class="image-modal">
    <span class="close-btn">&times;</span>
    <div class="modal-content">
        <img class="modal-image" id="modal-image" alt="Enlarged memory image">
        <div class="modal-info" id="modal-info"></div>
    </div>
</div>

</body>
</html>
